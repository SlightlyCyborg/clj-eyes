(ns clj-eyes.web-server
  (:require
   weasel.repl.websocket
   [org.httpkit.server :as server]
   [clj-eyes.templates.image-frame :as image-frame])
  (:use
   ring.middleware.file 
   ring.middleware.params 
   ring.middleware.session
   hiccup.core))

(defn home-handler [request]
  {:status  200
   :headers {"Content-Type" "text/html"}
   :body 
    (html [:html
           [:head
            [:script {:src "js/clj-eyes.js"}]]
           [:body
            (image-frame/render)]])})

(defn handler [request]
  (let [routes 
    { "/" home-handler }]
  ((routes (request :uri)) request)))

(def main-handler 
  (-> handler 
      (wrap-file "resources/public")
      (wrap-params)
      (wrap-session)))

(def server-instance (server/run-server main-handler {:port 8081}))

